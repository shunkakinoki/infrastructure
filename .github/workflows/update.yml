name: Update Github Repo
on:
  schedule:
    - cron: "*/3 * * * *"
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout from Repository
        id: checkout
        uses: actions/checkout@master

      - name: Checkout from shunkakinoki
        uses: actions/checkout@master
        with:
          path: tmp
          repository: shunkakinoki/shunkakinoki
          ref: master

      - name: Copy Repository Contents
        run: |
          mkdir /home/runner/work/shunblog/tmp/.vuepress
          cp -a $GITHUB_WORKSPACE/src/.vuepress/. /home/runner/work/shunblog/tmp/.vuepress/
          rsync -aqu --delete /home/runner/work/shunblog/tmp/src/ $GITHUB_WORKSPACE/src
          mkdir $GITHUB_WORKSPACE/src/.vuepress
          cp -a /home/runner/work/shunblog/tmp/.vuepress/. $GITHUB_WORKSPACE/src/.vuepress/

      - name: Set Output Variables
        id: vars
        run: |
          echo ::set-output name=pr_title::"Sync Github Repo $(date +%d-%m-%Y)"
          echo ::set-output name=pr_body::"This PR was auto-generated on $(date +%d-%m-%Y) \
            by [create-pull-request](https://github.com/peter-evans/create-pull-request)."

      - name: Create a Pull Request if Updated
        uses: peter-evans/create-pull-request@v1.5.4
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          COMMIT_AUTHOR_EMAIL: shunkakinoki@gmail.com
          COMMIT_AUTHOR_NAME: Shun Kakinoki
          PULL_REQUEST_TITLE: ${{ steps.vars.outputs.pr_title }}
          PULL_REQUEST_BODY: ${{ steps.vars.outputs.pr_body }}
          PULL_REQUEST_BRANCH: sync
          BRANCH_SUFFIX: short-commit-hash
